<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>出貨地址選擇</title>
    <link href="statics\css\searchform.css" rel="stylesheet">
    <link href="menu_style.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">

    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type='text/javascript'>
    window.onload = function() {
        var table = document.getElementById("receiver_detail_table");
        var rowCount = table.rows.length;
        console.log(rowCount);

        axios.defaults.headers.post["Content-Type"] = "application/json;charset=utf-8";
        axios.post('https://webapi.vastar.com.tw/erpapi/api/Receiver/List', {
                UserID: 'vastar',
                Password: 'vastar@2673',
                CustomerNo: getCookie("CustomerNo")
            })
            .then((response) => {
                console.log(response);
                console.log(response.data.length);
                console.log(response.data)
                var address = response.data[0]["City"] + response.data[0]["District"] + response.data[0][
                    "Address"
                ]
                if (response.data[0]["Result"] == 0) {
                    for (var i = 1; i < response.data.length + 1; i++) {
                        table.rows[i].cells[1].innerHTML = response.data[i - 1]["Receiver_No"];
                        table.rows[i].cells[2].innerHTML = response.data[i - 1]["Receiver_Name"];
                        table.rows[i].cells[3].innerHTML = response.data[i - 1]["Receiver_Tag"];
                        table.rows[i].cells[4].innerHTML = response.data[i - 1]["Receiver_Mobile_Phone_No"];
                        table.rows[i].cells[5].innerHTML = response.data[i - 1]["Receiver_Phone_No"];
                        table.rows[i].cells[6].innerHTML = response.data[i - 1]["Receiver_Zip_Code"];
                        table.rows[i].cells[7].innerHTML = response.data[i - 1]["Receiver_Address"];


                    }
                }
                // response.data.forEach(function(value){
                //     table.HTML = value["Customer_No"];
                // });
            })
            .catch((error) => console.log(error));
    }
    </script>
</head>

<body bgcolor="#E0E0E0">

    <div>
        <form method="post" action="" class="form-query">



            <div class="action">
                <div class="div-form-button">
                    <input type="submit" id="confirmbutton" name="action" value="確認"
                        style="margin-left:-380px; width:70px"></input>
                </div>
            </div>


        </form>

    </div>
    <center>
        <table id="receiver_detail_table" border="1" rules="all" cellpadding="5" cellspacing="50" style=" font-size:14px; border: 0.5px solid ; 
           border-collapse: collapse; width: 790px; ">
            <thead>
                <tr height="30" align="center">
                    <td width="20"></td>
                    <td>收件人編號</td>
                    <td>收件人名稱</td>
                    <td>收件人標籤</td>
                    <td>收件人電話</td>
                    <td>收件人手機</td>
                    <td>郵遞區號</td>
                    <td>地址</td>
                </tr>
            </thead>
            <tbody>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr contenteditable="false">
                    <td contenteditable="false" align="center"><input type="checkbox" name='checkbox'></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <script type="text/javascript">
        $(document).ready(function() {

            $("input:checkbox").on('click', function() {
                // in the handler, 'this' refers to the box clicked on
                var $box = $(this);
                if ($box.is(":checked")) {
                    // the name of the box is retrieved using the .attr() method
                    // as it is assumed and expected to be immutable
                    var group = "input:checkbox[name='" + $box.attr("name") + "']";
                    // the checked state of the group/box on the other hand will change
                    // and the current value is retrieved using .prop() method
                    $(group).prop("checked", false);
                    $box.prop("checked", true);
                } else {
                    $box.prop("checked", false);
                }
            });

        });
        $(function() {
            //Assign Click event to Button.
            var el = document.getElementById('confirmbutton');
            console.log($('input[name="checkbox"]:checked'));
            var sales_tab = window.opener.document.getElementById("sales_detail_table");
            el.addEventListener('click', function() {
                var address = ""
                $($('input[name="checkbox"]:checked')).each(function() {
                    var row = $(this).closest("tr")[0];
                    address += row.cells[7].innerHTML;
                    // 把收貨人編號儲存在localStorage
                    localStorage.setItem('Receiver_No', row.cells[1].innerHTML);
                });

                var trClicked = getCookie("chooseaddressclick");
                sales_tab.rows[trClicked].cells[8].innerHTML = address; // 產品名稱
                window.close();
            });


        });

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return decodeURI(parts.pop().split(';').shift());
            //因為獲得的php setcookie()得到的cookie值, 會進行urlencode,
            // 所以return時要記的進行decode
        }

        //刪除cookie值
        function clearCookie(name) {
            setCookie(name, "", -1);
        }
        </script>
</body>

</html>